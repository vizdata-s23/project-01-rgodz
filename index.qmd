---
title: "Project title"
subtitle: "STA/ISS 313 - Project 1"
author: "Team Name"
format: html
editor: visual
---

```{r}
#| label: load-pkgs
#| message: false
#| warning: false

library(tidyverse)
library(dplyr)
library(stringr)
```

```{r}
#| label: load-data
#| message: false

matches <- read.csv("data/wcmatches.csv")
wc <- read.csv("data/worldcups.csv")
```

## Abstract

(1 paragraph): Project abstract.

------------------------------------------------------------------------

## Introduction

(1-2 paragraphs): Brief introduction to the dataset. You may repeat some of the information about the dataset provided in the introduction to the dataset on the TidyTuesday repository, paraphrasing on your own terms. Imagine that your project is a standalone document and the grader has no prior knowledge of the dataset.

## Question 1: Title that relates to the question you're answering

### Introduction

(1-2 paragraphs): Introduction to the question and what parts of the dataset are necessary to answer the question. Also discuss why you're interested in this question.

#### How has the total number of goals scored in a match changed over time, and does the round in which a match is played correlate with the total number of goals scored in a match?

### Approach

(1-2 paragraphs): Describe what types of plots you are going to make to address your question. For each plot, provide a clear explanation as to why this plot (e.g. boxplot, barplot, histogram, etc.) is best for providing the information you are asking about. The two plots should be of different types, and at least one of the two plots needs to use either color mapping or facets.

To answer our first question, we will be looking at the variables `home_score`, `away_score`, `year`, and `stage`. We will have to create a new variable that can be called `total_goals` that is the sum of `home_score` and `away_score` since we are interested in the number of goals scored per match. Also, we will have to do some data manipulation with the `stage` variable so that all group stage games are under the same category, as they currently have different names based on the group name (i.e. "Group A", "Group B", etc.) but are all a part of the same round of a World Cup. No external data is needed for this analysis. For our visualization, our current plan is to create a violin plot for the distribution of goals scored for each year that is faceted by the round. So year will be on the x-axis and goals scored will be on the y-axis with each plot showing the distribution of the data points that came from a specific stage in the tournament. We will need to reorder the points so that the order of the faceted plots makes sense in context (such that the first plot shows the group stage distributions and the final round will be the last plot). There are multiple ways we can display the data from these three variables, however, so depending on how well the described graphic shows the relationships we are interested in we may decide to change how we plot them, but this is our current plan. Following a suggestion from one of our peer reviews, for our second visualization to answer this question we will create a line plot with the average number of goals scored per game as the y-axis variable and year on the x-axis, separated by which round of the tournament. The chart would have different lines colored by tournament stage and display the change in average goals scored per game over the years for each round of the World Cup. This should give us a better sense of how goals scored per match differs by year and round on average as opposed to looking at the actual distributions in the violin plots.

### Analysis

```{r}
#| label: data-manipulation

matches_q1 <- matches %>%
  filter(stage != "Third place") |>
  mutate(stage = if_else(str_detect(stage, "Group"), "Group Stage", if_else(str_detect(stage, "Final"), "Final", stage)),
         total_score = home_score + away_score) |>
  mutate(year_group = if_else(year <= 1962, "1930 - 1962",
                              if_else( year <= 1990, "1966 - 1990", "1994-2018")))


```

```{r}
#| label: Q1-viz-1
matches_q1 |>
  group_by(year, stage) |>
  summarize(goals = mean(total_score)) |>
  ggplot(aes(x = year, y = goals, color = stage)) +
  geom_point() +
  geom_line() +
  theme_minimal()

matches_q1 |>
  group_by(stage, year_group) |>
  summarize(goals = mean(total_score)) |>
  ggplot(aes(x = stage, y = goals, fill = stage)) +
  facet_wrap(~year_group) +
  geom_col() +
  theme_minimal()
  
  

  
  

```

(2-3 code blocks, 2 figures, text/code comments as needed): In this section, provide the code that generates your plots. Use scale functions to provide nice axis labels and guides. You are welcome to use theme functions to customize the appearance of your plot, but you are not required to do so. All plots must be made with **ggplot2**. Do not use base R or lattice plotting functions.

### Discussion

(1-3 paragraphs): In the Discussion section, interpret the results of your analysis. Identify any trends revealed (or not revealed) by the plots. Speculate about why the data looks the way it does.

## Question 2: Title that relates to the question you're answering

### Introduction

(1-2 paragraphs): Introduction to the question and what parts of the dataset are necessary to answer the question. Also discuss why you're interested in this question.

#### Over the course of the FIFA World Cup's tenure, which nations have had the most success aggregated across all tournaments from 1930 to 2018 when considering semi-final appearances and overall goal differential?

### Approach

(1-2 paragraphs): Describe what types of plots you are going to make to address your question. For each plot, provide a clear explanation as to why this plot (e.g. boxplot, barplot, histogram, etc.) is best for providing the information you are asking about. The two plots should be of different types, and at least one of the two plots needs to use either color mapping or facets.

To answer our second question, we look to create two visualizations ranking participating nations on their all-time World Cup performance. For our first visualization, we will be looking at the variables `winner`, `second`, `third`, and `fourth` from the `wc` dataset. We will count the amount of times from 1930 to 2018 that individual countries have made it into the top four teams of the tournament, indicated by being listed as `winner`, `second`, `third`, and `fourth` in the `wc` dataset. This count will manifest as the plot's x-axis with country names in descending order on the y-axis. This visualization will give us a sense of which teams have had the most success with deep runs in the tournament over time. To answer the second part of our question we will be using data from the `matches` dataset. In order to analyze each country's goal differential we must first do some data manipulation. First, we need to pivot the dataframe of matches longer so that each match now has two rows, with one the home and away columns being switched to team and opponent ones so that every second row is the same as the row before it in the opposite order. In case this is unclear, for example if there was a match in which Spain lost to Morocco 1-2, the first row would contain 1 under the `team_score` column and 2 under the `opponent_score` column and the following row would contain 2 under the `team_score` column and 1 under the `opponent_score` column. Then, goal differential will be calculated as `team_score` - `opponent_score`. Lastly, we will group the table by country and summarize using the sum of the new `goal_differential` column to be the dataframe we use in our analysis. The visualization will be faceted by country (descending order based on aggregate goal differential) and include a collection of line graphs using `geom_line()` that tracks each nation's goal differential in each World Cup with the new goal differential variable on the y-axis and the year of each World Cup on the x-axis. We will most likely decide to limit the amount of countries we display due to the large number who have participated in the World Cup but we will figure this out once we have the data ready to visualize. This visualization will give us a sense of which team's have the highest overall goal differential while also being able to gauge how that has varied from tournament to tournament over time by country. Our team may pivot to analyzing average goal differential aside from total if we feel it makes most sense in the context of the data given historic FIFA politics surrounding which nations have been permitted to participate.

### Analysis

(2-3 code blocks, 2 figures, text/code comments as needed): In this section, provide the code that generates your plots. Use scale functions to provide nice axis labels and guides. You are welcome to use theme functions to customize the appearance of your plot, but you are not required to do so. All plots must be made with **ggplot2**. Do not use base R or lattice plotting functions.

```{r}
#| label: data-manipulation-2

matches_q2 <- matches %>%
    pivot_longer(
    cols = c("home_team", "away_team"),
    names_to = "home_away",
    values_to = "team"
  ) %>%
  mutate(goal_differential = if_else(
    home_away == "home_team",
    home_score - away_score,
    away_score - home_score)) %>%
  group_by(team) %>%
  summarise(total_goal_diff = sum(goal_differential), games = n())

wc_q2 <- wc %>%
    pivot_longer(
    cols = c("winner", "second", "third", "fourth"),
    names_to = "placement",
    values_to = "team"
  )
  
```

### Discussion

(1-3 paragraphs): In the Discussion section, interpret the results of your analysis. Identify any trends revealed (or not revealed) by the plots. Speculate about why the data looks the way it does.

#### 
